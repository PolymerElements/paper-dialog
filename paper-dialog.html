<!--
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../paper-dialog-behavior/paper-dialog-behavior.html">
<link rel="import" href="../paper-dialog-behavior/paper-dialog-shared-styles.html">
<!--
Material design: [Dialogs](https://www.google.com/design/spec/components/dialogs.html)

`<paper-dialog>` is a dialog with Material Design styling and optional animations when it is
opened or closed. It provides styles for a header, content area, and an action area for buttons.
You can use the `<paper-dialog-scrollable>` element (in its own repository) if you need a scrolling
content area. To autofocus a specific child element after opening the dialog, give it the `autofocus`
attribute. See `Polymer.PaperDialogBehavior` and `Polymer.IronOverlayBehavior` for specifics.

For example, the following code implements a dialog with a header, scrolling content area and
buttons. Focus will be given to the `dialog-confirm` button when the dialog is opened.

    <paper-dialog>
      <h2>Header</h2>
      <paper-dialog-scrollable>
        Lorem ipsum...
      </paper-dialog-scrollable>
      <div class="buttons">
        <paper-button dialog-dismiss>Cancel</paper-button>
        <paper-button dialog-confirm autofocus>Accept</paper-button>
      </div>
    </paper-dialog>

### Changes in 2.0
- `paper-dialog-behavior 2.0` styles only direct `h2` and `.buttons` children of the dialog because of how [`::slotted` works](https://developers.google.com/web/fundamentals/primers/shadowdom/?hl=en#stylinglightdom)
(compound selector will select only top level nodes)
- `<paper-dialog>` uses CSS animation keyframes instead of `neon-animation`, ([see Animations section](#Animations))

### Styling

See the docs for `Polymer.PaperDialogBehavior` for the custom properties available for styling
this element.

### Animations

Set the `entry-animation` and/or `exit-animation` attributes to add an animation when the dialog
is opened or closed. Included in the component are:
- fade-in-animation
- fade-out-animation
- scale-up-animation
- scale-down-animation

These animations are not based on the deprecated `neon-animation` component, and use CSS keyframe animations.
This change reduces code size, and uses the platform. You can implement custom entry/exit animations using
CSS keyframe animations; define the animation keyframes, a CSS class for the animation, and assign the class to the `entry/exit-animation`, e.g.

    <style>
      \@keyframes appear-from-top {
        0% {
          transform: translateY(-2000px);
          opacity: 0;
        }
        10% {
          opacity: 0.2;
        }
      }

      .appear-from-top {
        animation-name: appear-from-top;
        animation-timing-function: cubic-bezier(0.0, 0.0, 0.2, 1);
        animation-duration: 500ms;
      }
    </style>

    <paper-dialog entry-animation="appear-from-top"
                  exit-animation="fade-out-animation">
      <h2>Header</h2>
      <div>Dialog body</div>
    </paper-dialog>

### Accessibility

See the docs for `Polymer.PaperDialogBehavior` for accessibility features implemented by this
element.

@group Paper Elements
@element paper-dialog
@hero hero.svg
@demo demo/index.html
-->

<dom-module id="paper-dialog">
  <template>
    <style include="paper-dialog-shared-styles">
      :host {
        animation-duration: 500ms;
        animation-fill-mode: both;
        animation-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
      }

      :host(.fade-in-animation) {
        animation-name: fade-in-animation;
      }

      @keyframes fade-in-animation {
        from {
          opacity: 0;
        }
      }

      :host(.fade-out-animation) {
        animation-name: fade-out-animation;
      }

      @keyframes fade-out-animation {
        to {
          opacity: 0;
        }
      }

      :host(.scale-up-animation) {
        animation-name: scale-up-animation;
      }

      @keyframes scale-up-animation {
        from {
          transform: scale(0.0);
        }
      }

      :host(.scale-down-animation) {
        animation-name: scale-down-animation;
      }

      @keyframes scale-down-animation {
        to {
          transform: scale(0.0);
        }
      }
    </style>
    <slot></slot>
  </template>
</dom-module>

<script>
  Polymer({
    is: 'paper-dialog',

    behaviors: [
      Polymer.PaperDialogBehavior
    ],

    listeners: {
      'animationend': '_onAnimationEnd',
    },

    properties: {
      /**
       * Deprecated, use `entryAnimation` and `exitAnimation` instead.
       * `paper-dialog` doesn't depend anymore on `neon-animation`, and this property is kept
       * here to not break bindings. Setting it won't have effects on the animation.
       * @deprecated
       */
      animationConfig: {
        type: Object
      },

      /**
       * The class defining the entry animation. `<paper-dialog>` ships
       * `fade-in-animation, fade-out-animation, scale-up-animation, scale-down-animation`,
       * but you can use custom animations too. See the Animations section in the README.md.
       */
      entryAnimation: {
        type: String
      },
      /**
       * The class defining the exit animation. `<paper-dialog>` ships
       * `fade-in-animation, fade-out-animation, scale-up-animation, scale-down-animation`,
       * but you can use custom animations too. See the Animations section in the README.md.
       */
      exitAnimation: {
        type: String
      }
    },

    ready: function() {
      if (this.animationConfig) {
        console.warn('Configuring animations through animationConfig is no longer supported.' +
          'Use entryAnimation and exitAnimation instead.');
      } else if (this.entryAnimation || this.exitAnimation) {
        // Keep this for backwards-compat.
        this.animationConfig = {
          entry: {
            name: this.entryAnimation
          },
          exit: {
            name: this.exitAnimation
          },
        };
      }
    },

    /**
      * `paper-dialog` doesn't depend anymore on `neon-animation`.
      * This method was previously inherited from `Polymer.NeonAnimatableBehavior`,
      * now is a no-op.
      * @deprecated
      */
    cancelAnimation: function() {},

    /**
      * `paper-dialog` doesn't depend anymore on `neon-animation`.
      * This method was previously inherited from `Polymer.NeonAnimatableBehavior`,
      * now is a no-op.
      * @param {string=} type
      * @param {!Object=} cookie
      * @deprecated
      */
    playAnimation: function(type, cookie) {},

    /**
      * `paper-dialog` doesn't depend anymore on `neon-animation`.
      * This method was previously inherited from `Polymer.NeonAnimatableBehavior`,
      * now is a no-op.
      * @deprecated
      */
    getAnimationConfig: function(type) { return []; },

    /**
     * @private
     */
    _renderOpened: function() {
      this._cancelAnimation();
      this._playAnimation(this.entryAnimation);
    },

    /**
     * @private
     */
    _renderClosed: function() {
      this._cancelAnimation();
      this._playAnimation(this.exitAnimation);
    },

    /**
     * @private
     */
    _cancelAnimation: function() {
      if (this._pendingAnimation) {
        this.classList.remove(this._pendingAnimation);
        this._pendingAnimation = null;
      }
    },

    /**
     * @param {string=} animation
     * @private
     */
    _playAnimation: function(animation) {
      if (animation) {
        this._pendingAnimation = animation;
        this.classList.add(animation);
        if (this._willAnimate() === false) {
          console.info(animation + ' animation was not played');
          this._onAnimationEnd();
        }
      } else {
        this._onAnimationEnd();
      }
    },

    /**
     * @param {Event=} event
     * @private
     */
    _onAnimationEnd: function(event) {
      if (event && event.target !== this) {
        return;
      }
      this._cancelAnimation();
      if (this.opened) {
        this._finishRenderOpened();
      } else {
        this._finishRenderClosed();
      }
    },

    /**
     * @private
     */
    _willAnimate: function() {
      // If CSS Class does not have animation-name considered not be an animation
      var style = window.getComputedStyle(this);
      return (style.getPropertyValue('animation-name') !== 'none' &&
        style.getPropertyValue('animation-duration') !== '0ms');
    }

  });
</script>